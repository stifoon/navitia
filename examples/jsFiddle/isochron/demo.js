function drawIsochron(e){var t=[];$.each(e.journeys,function(e,n){t.push({to:[parseFloat(n.to.stop_point.coord.lat),parseFloat(n.to.stop_point.coord.lon)],duration:n.duration,data:n})});var n=createGeoJsonFromIsochron(t);drawGeoJson(map,n),map.on("zoomend",function(){drawGeoJson(map,n)})}function createGeoJsonFromIsochron(e){var t={name:"Points",type:"FeatureCollection",features:[]};return $.each(e,function(e,n){t.features.push({type:"Feature",geometry:{type:"Point",coordinates:n.to.reverse()},properties:{color:colorFromDuration(n.duration),journey:n.data}})}),t}function drawGeoJson(e,t){null!==geojsonLayer&&e.removeLayer(geojsonLayer),geojsonLayer=L.geoJson(t,{style:function(e){return{color:e.properties.color}},pointToLayer:function(t,n){var i=Math.pow(2,e.getZoom())/1e3;return new L.CircleMarker(n,{radius:i,fillOpacity:.6})},onEachFeature:function(e,t){var n=e.properties.journey,i=Math.floor(n.duration/60)+"min"+n.duration%60+"s ("+n.duration+"s)",o=n.links[0].href.replace("://","://"+sandboxToken+"@");t.bindPopup(["<b>"+n.to.name+"</b>",i,'<a href="'+o+'" target="_blank">Journeys to this point</a>'].join("<br>"))}}),e.addLayer(geojsonLayer)}function colorFromDuration(e){var t="FF0000",n="00FF00",i=e/maxDuration;i*=i;var o=function(e){return e=e.toString(16),1===e.length?"0"+e:e},s=Math.ceil(parseInt(t.substring(0,2),16)*i+parseInt(n.substring(0,2),16)*(1-i)),r=Math.ceil(parseInt(t.substring(2,4),16)*i+parseInt(n.substring(2,4),16)*(1-i)),a=Math.ceil(parseInt(t.substring(4,6),16)*i+parseInt(n.substring(4,6),16)*(1-i)),c=o(s)+o(r)+o(a);return"#"+c}var sandboxToken="a61f4cd8-3007-4557-9f4c-214969369cca",from=[48.846905,2.377097],maxDuration=2e3,isochronUrl="https://api.navitia.io/v1/coverage/sandbox/journeys?from="+from[1]+";"+from[0]+"&max_duration="+maxDuration;$.ajax({type:"GET",url:isochronUrl,dataType:"json",headers:{Authorization:"Basic "+btoa(sandboxToken)},success:drawIsochron,error:function(e,t,n){alert('Error when trying to process isochron: "'+t+'", "'+n+'"')}});var tiles={url:"http://www.toolserver.org/tiles/bw-mapnik/{z}/{x}/{y}.png",attrib:'Navitia Isochron example \xa9 <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'},map=L.map("map").setView(from,13).addLayer(new L.TileLayer(tiles.url,{minZoom:0,maxZoom:16,attribution:tiles.attrib}));L.marker(from).addTo(map);var geojsonLayer=null;